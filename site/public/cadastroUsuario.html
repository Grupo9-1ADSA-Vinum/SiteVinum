<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Cadastro</title>
    <link rel="stylesheet" href="styleCadastro.css">
    <link rel="stylesheet" href="styleCadastroUsuario.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <script src="js/sessao.js"></script>
</head>

<body onload="listarUsuarios()" style="background-color: lightgray;">
    <div class="header" style="background-color: #763A5A; margin-bottom: 40px;">
        <div class="isolada">
            <img src="assets/imgs/icons8-wine-glass-64 1.png" alt="">
            <h1 style="color: white;">Vinum</h1>
        </div>
        <div class="dropdown">
            <img src="assets/imgs/1975845.png"
                alt="" style="width: 70px; height: 70px;">
            <div class="dropdown_conteudo">
                <ul class="links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="index.html">Sobre</a></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="index.html">Contato</a></li>
                </ul>
                <a onclick="limparSessao()" class="action_btn">Sair</a>
            </div>
        </div>
    </div>
    <div class="container_cadastroDelete">
        <div class="colunaCadastro">
            <h2 class="cadastrar">Cadastre seu usuário!</h2>
            <div class="form">

                <label class="label-input" for="">
                    <i class="far fa-user icon-modify"></i>
                    <input id="nomeUsuario_input" type="text" placeholder="Nome">
                </label>

                <label class="label-input" for="">
                    <i class="far fa-user icon-modify"></i>
                    <input id="cpf_input" type="text" placeholder="CPF">
                </label>

                <label class="label-input" for="">
                    <i class="far fa-envelope icon-modify"></i>
                    <input id="emailUsuario_input" type="email" placeholder="E-mail">
                </label>

                <label class="label-input" for="">
                    <i class="far fa-envelope icon-modify"></i>
                    <input id="confirmacao_email_input" type="email" placeholder="Confirmar E-mail">
                </label>

                <label class="label-input" for="">
                    <i class="fas fa-lock icon-modify"></i>
                    <input id="senhaUsuario_input" type="password" placeholder="Senha">
                </label>

                <label class="label-input" for="">
                    <i class="fas fa-lock icon-modify"></i>
                    <input id="confirmacao_senha_input" type="password" placeholder="Confirmar senha">
                </label>

                <button onclick="cadastrarUsuarios()">Cadastrar</button>
            </div>
        </div>
        <div class="colunaDeletar">
            <h2 class="cadastrar">Delete um usuário!</h2>
            <div class="form">
                <div class="planos_selecionado">
                    <select name="Selecionar_Plano" id="selecionar_usuario_input">
                        <!-- <option value="1">Miolo</option>
                    <option value="2">Castilla</option>
                    <option value="3">Domaine</option> -->
                    </select>
                </div>
                <label class="label-input" for="">
                    <i class="fas fa-lock icon-modify"></i>
                    <input id="senha_input" type="password" placeholder="Sua senha">
                </label>

                <button onclick="deletarFuncionario()">Deletar</button>
            </div>
        </div>
    </div>
    <div id="cardErro">
        <div id="mensagem_erro">
        </div>
    </div>
    <div class="footer" id="suporte">
        <div class="footer1">
            <div class="bloco">
                <img src="assets/imgs/icons8-location-pin-48 1.png">
                <div class="texto">
                    <h4 class="titulo-footer">Endereço</h4>
                    <h6>Rua Haddock Lobo, 595 São Paulo - SP</h6>
                </div>
            </div>
            <div class="bloco">
                <img src="assets/imgs/icons8-phone-48 1.png">
                <div class="texto">
                    <h4 class="titulo-footer">Telefone</h4>
                    <h6>(11) 3589-4043</h6>
                </div>
            </div>
            <div class="bloco">
                <img src="assets/imgs/icons8-email-48 1.png">
                <div class="texto">
                    <h4 class="titulo-footer">E-mail</h4>
                    <h6>projeto.vinum@sptech.school</h6>
                </div>
            </div>
        </div>
        <div class="pai-linha">
            <div class="linha1">
                <div class="footer2">
                    <div class="bloco">
                        <img src="assets/imgs/icons8-wine-glass-64 1.png">
                        <div class="texto">
                            <h3 class="titulo-footer">Vinum</h3>
                            <h6>soluções para sua adega</h6>
                        </div>
                    </div>
                    <div class="redes">
                        <h5 class="titulo-footer">Nos siga!</h5>
                        <div class="imagens">
                            <img src="assets/imgs/icons8-whatsapp-48 1.png">
                            <img src="assets/imgs/icons8-facebook-48 1.png">
                            <img src="assets/imgs/icons8-instagram-48 1.png">
                            <a href="https://github.com/Vinum-Grupo8-1ADSA">
                                <img src="assets/imgs/github (1).png"></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>
<script>
    var empresaVar = sessionStorage.getItem('idDistribuidora');
    function cadastrarUsuarios() {
        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var nomeUsuarioVar = nomeUsuario_input.value;
        var cpfVar = cpf_input.value;
        var emailVar = emailUsuario_input.value;
        var confirmacaoEmailVar = confirmacao_email_input.value;
        var senhaVar = senhaUsuario_input.value;
        var confirmacaoSenhaVar = confirmacao_senha_input.value;



        if (
            cpfVar == "" ||
            emailVar == "" ||
            confirmacaoEmailVar == "" ||
            senhaVar == "" ||
            confirmacaoSenhaVar == ""
        ) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Mensagem de erro para todos os campos em branco)";
            sumirMensagem()
            return false;

        } else if (nomeUsuarioVar.length <= 1) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Insira um nome maior que 1 letra)";
            sumirMensagem()
            return false;

        } else if (senhaVar.length < 6) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Senha deve ser maior ou igual a 6 digitos)";
            sumirMensagem()
            return false;

        } else if (senhaVar != confirmacaoSenhaVar) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Senhas diferentes)";
            sumirMensagem()
            return false;

        } else if (cpfVar.length < 11) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Digite um cnpj válido de até 11 digitos)";
            sumirMensagem()
            return false;
        } else if (emailVar != confirmacaoEmailVar) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Os E-mails não coincidem)";
            sumirMensagem()
            return false;
        } else {
            fetch("/usuarios/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    nomeUsuarioServer: nomeUsuarioVar,
                    cpfServer: cpfVar,
                    emailServer: emailVar,
                    senhaServer: senhaVar,
                    idDistribuidoraServer: empresaVar
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {
                        cardErro.style.display = "block"
                        mensagem_erro.innerHTML = "Funcionario cadastrado com sucesso!<br>Recarregue a página para visualizar"
                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);

                });

            return false;
        }
    }
    function sumirMensagem() {
        setTimeout(() => {
            cardErro.style.display = "none"
        }, 5000);
    }
    // Enviando o valor da nova input

    function listarUsuarios() {
        fetch(`/usuarios/listarUsuarios/${sessionStorage.getItem('idDistribuidora')}`, {
            method: "GET",
        })
            .then(function (resposta) {
                resposta.json().then((Selecionar_Plano) => {
                    Selecionar_Plano.forEach((usuarios) => {
                        selecionar_usuario_input.innerHTML += `<option value='${usuarios.idUsuario}'>${usuarios.nomeUser} --CPF: ${usuarios.cpf}</option>`;
                    });
                });
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    };

    function deletarFuncionario() {
        var idFuncionario = selecionar_usuario_input.value
        fetch(`/usuarios/deletarFuncionario/${idFuncionario}`, {
            method: "GET",
        })
            .then(function (resposta) {
                resposta.json().then((usuario) => {
                    cardErro.style.display = "block"
                    cardErro.innerHTML = "Usuario deletado com sucesso, atualize a tela para ver as alterações"
                });
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }


    function ajuda() {
        alert(`Caso tenha duvida de qual plano contratar é só voltar para pagina "Home" e ir em "Calculadora"`);
    }
</script>