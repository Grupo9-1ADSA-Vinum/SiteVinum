<!DOCTYPE html>

<html lang="pt-br">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Cadastro</title>
    <link rel="stylesheet" href="styleCadastro.css">
    <link rel="stylesheet" href="styleLogin.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
    <link rel="stylesheet" href="../Main/index.html">
    <script src="../js/sessao.js"></script>
</head>

<body onload="listar()">

    <div class="header_login">
        <div class="logoDaEmpresa_login">
            <div class="container_login">
                <div class="logo">
                    <div class="imgLogo">
                        <img src="imgs/icons8-wine-glass-64 1.png" alt="">
                    </div>
                    <div class="textoLogo">
                        <h1>Vinum</h1>
                    </div>
                </div>

                <ul>
                    <a href="../Main/index.html">
                        <li>Home</li>
                    </a>
                    <a href="#suporte">
                        <li>Suporte</li>
                    </a>
                    <a onclick="ajuda()">
                        <li>Ajuda</li>
                    </a>
                </ul>
            </div>
        </div>
    </div>


    <div class="alerta_erro">
        <div class="card_erro" id="cardErro">
          <span id="mensagem_erro"></span>
        </div>

    <div class="container">
        <div class="content first-content">
            <div class="first-column">
                <h2 class="title title-primary">Olá, Amigo!</h2>
                <p class="description description-primary">Caso ja tenha uma conta</p>
                <p class="description description-primary">Aqui clique embaixo</p>
                <a href="../login_cadastro/login.html"><button id="signin" class="btn btn-primary">Login</button></a>
            </div>

            <div class="second-column">
                <h2 class="title title-second">Cadastrar - se</h2>
                <div class="social-media"></div>
                <div class="form">

                    <label class="label-input" for="">
                        <i class="far fa-user icon-modify"></i>
                        <input id="nomeFantasia_input" type="text" placeholder="Nome Fantasia">
                    </label>

                    <label class="label-input" for="">
                        <i class="far fa-user icon-modify"></i>
                        <input id="razaoSocial_input" type="text" placeholder="Razão Social">
                    </label>

                    <label class="label-input" for="">
                        <i class="far fa-envelope icon-modify"></i>
                        <input id="cnpj_input" type="cnpj" placeholder=" CNPJ">
                    </label>
                    <label class="label-input" for="">
                        <i class="far fa-envelope icon-modify"></i>
                        <input id="telefone_input" type="telefone" placeholder=" Número de Telefone">
                    </label>
                    <label class="label-input" for="">
                        <i class="far fa-envelope icon-modify"></i>
                        <input id="email_input" type="email" placeholder=" E-mail">
                    </label>

                    <label class="label-input" for="">
                        <i class="fas fa-lock icon-modify"></i>
                        <input id="senha_input" type="password" placeholder="Senha">
                    </label>

                    <label class="label-input" for="">
                        <i class="fas fa-lock icon-modify"></i>
                        <input id="confirmacao_senha_input" type="password" placeholder="Confirmar senha">
                    </label>

                    <div class="planos_selecionado">
                        <select name="Selecionar_Plano" id="select_plano_cadastro">
                            <!-- <option value="1">Miolo</option>
                            <option value="2">Castilla</option>
                            <option value="3">Domaine</option> -->
                        </select>

                    </div>
                </div>
                <button onclick="cadastrar()" class="btn btn-second">Criar</button>
            </div>
            <div id="div_aguardar" class="loading-div">
                <!-- <img src="assets/imgs/colocarGif" id="loading-gif"> -->
            </div>
        </div>
    </div>
    </div>
    <div class="footer" id="suporte">
        <div class="footer1">
            <div class="bloco">
                <img src="../assets/imgs/icons8-location-pin-48 1.png">
                <div class="texto">
                    <h4 class="titulo-footer">Endereço</h4>
                    <h6>Rua Haddock Lobo, 595 São Paulo - SP</h6>
                </div>
            </div>
            <div class="bloco">
                <img src="../assets/imgs/icons8-phone-48 1.png">
                <div class="texto">
                    <h4 class="titulo-footer">Telefone</h4>
                    <h6>(11) 3589-4043</h6>
                </div>
            </div>
            <div class="bloco">
                <img src="../assets/imgs/icons8-email-48 1.png">
                <div class="texto">
                    <h4 class="titulo-footer">E-mail</h4>
                    <h6>projeto.vinum@sptech.school</h6>
                </div>
            </div>
        </div>
        <div class="pai-linha">
            <div class="linha1">
                <div class="footer2">
                    <div class="bloco">
                        <img src="../assets/imgs/icons8-wine-glass-64 1.png">
                        <div class="texto">
                            <h3 class="titulo-footer">Vinum</h3>
                            <h6>soluções para sua adega</h6>
                        </div>
                    </div>
                    <div class="redes">
                        <h5 class="titulo-footer">Nos siga!</h5>
                        <div class="imagens">
                            <img src="../assets/imgs/icons8-whatsapp-48 1.png">
                            <img src="../assets/imgs/icons8-facebook-48 1.png">
                            <img src="../assets/imgs/icons8-instagram-48 1.png">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
<script>
    function cadastrar() {
        aguardar();

        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var nomeFantasiaVar = nomeFantasia_input.value;
        var razaoSocialVar = razaoSocial_input.value;
        var cnpjVar = cnpj_input.value;
        var telefoneVar = telefone_input.value;
        var emailVar = email_input.value;
        var senhaVar = senha_input.value;
        var confirmacaoSenhaVar = confirmacao_senha_input.value;
        var empresaVar = select_plano_cadastro.value;
        if (
            nomeFantasiaVar == "" ||
            cnpjVar == "" ||
            emailVar == "" ||
            senhaVar == "" ||
            confirmacaoSenhaVar == "" ||
            empresaVar == ""
        ) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Mensagem de erro para todos os campos em branco)";

            finalizarAguardar();
            return false;

        } else if (nomeFantasiaVar.length <= 1) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Insira um nome maior que 1 letra)";
            finalizarAguardar();
            return false;

        } else if (senhaVar.length < 6) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Senha deve ser maior ou igual a 6 digitos)";
            finalizarAguardar();
            return false;

        } else if (senhaVar != confirmacaoSenhaVar) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Senhas diferentes)";
            finalizarAguardar();
            return false;

        } else if (cnpjVar.length < 14) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "(Digite um cnpj válido de até 11 digitos)";
            finalizarAguardar();
            return false;
        } else {
            setInterval(sumirMensagem, 5000);
        }

        // Enviando o valor da nova input
        fetch("/empresas/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeFantasiaServer: nomeFantasiaVar,
                razaoSocialServer: razaoSocialVar,
                telefoneServer: telefoneVar,
                cnpjServer: cnpjVar,
                emailServer: emailVar,
                senhaServer: senhaVar,
                planoServer: empresaVar
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    cardErro.style.display = "block";

                    mensagem_erro.innerHTML =
                        "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

                    setTimeout(() => {
                        window.location = "login.html";
                    }, "2000");

                    limparFormulario();
                    finalizarAguardar();
                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                finalizarAguardar();
            });

        return false;
    }

    function listar() {
        fetch("/planos/listar", {
            method: "GET",
        })
            .then(function (resposta) {
                resposta.json().then((planos) => {
                    planos.forEach((planos) => {
                        select_plano_cadastro.innerHTML += `<option value='${planos.idAssinaturas}'>${planos.nomeAssinatura}</option>`;
                    });
                });
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
    }

    function sumirMensagem() {
        cardErro.style.display = "none";
    }

    function ajuda() {
        alert(`Caso tenha duvida de qual plano contratar é só voltar para pagina "Home" e ir em "Calculadora"`);
    }

</script>